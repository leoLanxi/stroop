## 问题分析
- 501 错误来源：前端将注册请求发到了静态端口 `http://localhost:8000/api/...`，该端口不支持 POST。
- 提交 UNAUTHORIZED：前端使用 `127.0.0.1:5050` 调用后端，而登录页在 `localhost:8000`。在多数浏览器中，`localhost` 与 `127.0.0.1` 不是同一站点，`SameSite=Lax` 的 session Cookie 不会在跨站 XHR/Fetch 中携带，导致提交接口报 401。

## 修复方案
### 1) 统一前端与后端的主机名为 `localhost`
- 将前端 API 基地址首选改为 `http://localhost:5050/api`，仅在无法访问时再回退到 `http://127.0.0.1:5050/api` 与 `/api`。
- 这样登录设置的 Cookie (Host-only: `localhost`) 在同站点的前端 XHR/Fetch 中会随着 `credentials: 'include'` 正常携带，避免 UNAUTHORIZED。
- 修改：`assets/js/modules/api.js` 优先顺序调整为 `['http://localhost:5050/api', 'http://127.0.0.1:5050/api', '/api']`。

### 2) 明确 CORS 支持携带凭据
- 后端 CORS 已启用 `supports_credentials=True`；为了稳妥，指定资源匹配与允许来源：`resources={r"/api/*": {"origins": ["http://localhost:8000","http://127.0.0.1:8000"]}}`。
- 这样返回的 `Access-Control-Allow-Origin` 将是具体来源字符串，满足浏览器对 `withCredentials` 的要求。
- 修改：`server/app.py` 的 CORS 初始化。

### 3) 前端页面强制加载最新 JS
- 在页面脚本增加版本参数避免缓存导致仍使用旧的 API 基地址。
- 已做：`index.html` 脚本链接加 `?v=...`；确认继续保留。

### 4) 功能验证（浏览器端）
- 流程：
  1. 打开 `http://localhost:8000`（务必使用 localhost 而非 127.0.0.1）。
  2. 注册新用户（账号≥3、密码≥6）：期待成功提示；失败显示后端 `error` 文案。
  3. 登录：期待成功提示与进入游戏。
  4. 完成一局游戏（5 轮）：期待结果区域显示本局每题反应时间与正确/错误；自动提交到后端；下方显示全体统计。
  5. 点击「查看历史记录」：期待列表展示每局平均反应时间与错误率，以及总体平均。
  6. 点击「登出 / 切换账户」：期待返回登录页并提示。
- 同时观察后端日志：成功事件写入 `logs/access.log`，错误写入 `logs/error.log`。

### 5) 补强可配置与健壮性（可选）
- 增加 `window.__API_BASE__` 配置入口，若存在则优先使用；否则按内置顺序选择。
- 在 `api.js` 对 501/网络错误重试已实现，保留并记录必要的错误提示。

### 6) 保持结果展示需求
- 完成一局后结果区域保留本局每题反应时间与正确性（当前实现满足）。
- 重置时不影响已完成显示，新的游戏开始后将刷新为新一局数据（保持当前逻辑）。

## 将进行的具体修改
- `assets/js/modules/api.js`：将 API_BASES 改为 `['http://localhost:5050/api','http://127.0.0.1:5050/api','/api']`。
- `server/app.py`：将 `CORS(app, supports_credentials=True)` 改为 `CORS(app, supports_credentials=True, resources={r"/api/*": {"origins": ["http://localhost:8000","http://127.0.0.1:8000"]}})`。

## 交付验证
- 我会在浏览器按上述流程完成一次注册、登录、完成游戏、提交历史与全局统计、登出，期间如遇错误将记录并修复相关代码。

请确认以上方案，我将立即实施修改并在浏览器中完成端到端测试。